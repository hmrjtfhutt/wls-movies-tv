<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>WLS Movies & TV</title>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <style>
    :root{--bg:#0b0f14;--card:#0f1720;--accent:#e50914;--muted:#9aa4ae;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;color:#e6eef6;background:linear-gradient(180deg,#041018 0%,#07121a 100%);-webkit-font-smoothing:antialiased}
    header{padding:18px 20px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;gap:16px;align-items:center}
    .logo{display:flex;align-items:center;gap:12px}
    .logo .mark{width:44px;height:44px;background:var(--accent);display:flex;align-items:center;justify-content:center;border-radius:6px;font-weight:700;color:#fff}
    .title{font-size:18px;font-weight:600}
    .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
    .search{display:flex;align-items:center;background:var(--glass);padding:8px 10px;border-radius:8px;gap:8px;width:360px;max-width:52vw}
    .search input{border:0;background:transparent;color:inherit;outline:none;width:100%}
    .filters{display:flex;gap:10px;align-items:center;margin:14px 20px}
    .chip{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03);color:var(--muted);cursor:pointer;font-size:13px}
    .chip.active{background:var(--accent);color:#fff}
    .main{padding:16px 20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.02));border-radius:8px;padding:10px;cursor:pointer;transition:transform .15s ease,box-shadow .15s ease;display:flex;flex-direction:column;gap:8px}
    .card:hover{transform:translateY(-6px);box-shadow:0 8px 30px rgba(0,0,0,0.5)}
    .thumb{width:100%;aspect-ratio:16/9;border-radius:6px;background:#09202b;display:flex;align-items:center;justify-content:center;color:#9fb6c6;font-weight:600}
    .meta{display:flex;align-items:center;justify-content:space-between}
    .titleSmall{font-size:14px;font-weight:600}
    .sub{font-size:12px;color:var(--muted)}
    .tags{display:flex;gap:6px;flex-wrap:wrap}
    .tag{font-size:11px;background:rgba(255,255,255,0.03);padding:4px 8px;border-radius:999px;color:var(--muted)}
    .overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.5),rgba(0,0,0,0.7));display:none;align-items:center;justify-content:center;padding:28px;z-index:60}
    .overlay.show{display:flex}
    .panel{background:linear-gradient(180deg,#07121a,#05101a);border-radius:10px;padding:18px;width:min(980px,98%);display:grid;grid-template-columns:1fr 360px;gap:18px}
    .panel .big{display:flex;flex-direction:column;gap:12px}
    .panel .big .bigthumb{width:100%;aspect-ratio:16/9;border-radius:8px;overflow:hidden}
    .panel .side{background:rgba(255,255,255,0.02);padding:12px;border-radius:8px}
    .btn{background:var(--accent);color:#fff;padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#dbe9f5}
    .vote-btns{display:flex;gap:12px;margin-top:12px}
    .vote-btn{display:flex;align-items:center;gap:6px;padding:8px 12px;border-radius:8px;background:var(--glass);border:1px solid rgba(255,255,255,0.06);color:var(--muted);cursor:pointer;font-size:13px;transition:all .2s ease}
    .vote-btn:hover{background:rgba(255,255,255,0.06)}
    .vote-btn.active{background:var(--accent);border-color:var(--accent);color:#fff}
    .vote-btn svg{width:18px;height:18px}
    footer{padding:18px 20px;color:var(--muted);font-size:13px}
    @media (max-width:880px){.panel{grid-template-columns:1fr}.controls{display:none}.search{width:100%}}
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <div class="mark">C</div>
      <div>
        <div class="title">WLS Movies & TV</div>
        <div class="sub">Embed-friendly single-file catalog (search, filters, details)</div>
      </div>
    </div>

    <div class="controls">
      <div class="search" role="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M21 21l-4.35-4.35" stroke="#9aa4ae" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="11" cy="11" r="6" stroke="#9aa4ae" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></circle></svg>
        <input id="searchInput" placeholder="Search titles, genres, year..." aria-label="Search catalog">
      </div>
      <!-- Requests button (opens provided Google Form in a new tab) -->
      <a id="requestsBtn" class="btn" href="https://forms.gle/1XC4NnnKmcxdEFHE6" target="_blank" rel="noopener noreferrer" style="margin-left:8px">Requests</a>
    </div>
  </header>

  <div class="filters" aria-hidden>
    <!-- Tabs for explicit filtering: All / Movies / TV Shows -->
    <div id="tabs" style="display:flex;gap:8px;align-items:center">
      <button class="chip active" data-tab="All">All</button>
      <button class="chip" data-tab="Movie">Movies</button>
      <button class="chip" data-tab="TV">TV Shows</button>
    </div>
    <!-- legacy chips area (hidden) retained for backward compatibility -->
    <div id="categoryChips" class="chips" style="display:none"></div>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <select id="sortSelect" class="chip" aria-label="Sort">
        <option value="popular">Sort: Popular</option>
        <option value="title">Sort: Title</option>
        <option value="year">Sort: Year</option>
      </select>
      <button id="clearBtn" class="chip">Clear</button>
    </div>
  </div>

  <main class="main">
    <div id="grid" class="grid" role="list"></div>
  </main>

  <div id="overlay" class="overlay" role="dialog" aria-modal="true">
    <div class="panel" role="document">
      <div class="big">
        <div class="bigthumb" id="overlayThumb" aria-hidden></div>
        <h2 id="overlayTitle"></h2>
        <div id="overlayDesc" class="sub"></div>
        <div style="margin-top:14px;display:flex;gap:8px">
          <button id="openParent" class="btn">Open on parent site</button>
          <button id="openNew" class="btn ghost">Open in new tab</button>
        </div>
      </div>
      <aside class="side">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="sub" id="overlayMeta"></div>
          <button id="closeOverlay" class="chip">Close</button>
        </div>
        <div style="margin-top:12px">
          <div class="sub">Genres</div>
          <div id="overlayTags" class="tags"></div>
          <div style="margin-top:16px">
            <div class="sub">Votes</div>
            <div class="vote-btns">
              <button id="likeBtn" class="vote-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg>
                <span id="likeCount">0</span>
              </button>
              <button id="dislikeBtn" class="vote-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2h-3"></path></svg>
                <span id="dislikeCount">0</span>
              </button>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <footer>Tip: host this HTML file publicly (GitHub Pages, S3, etc.), then embed via an iframe in Google Sites. See embedding notes below.</footer>

  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA_jhaLrDW_CXxN4iT-O2rlAWA0Q0AK66w",
      authDomain: "site2-c479a.firebaseapp.com",
      projectId: "site2-c479a",
      storageBucket: "site2-c479a.firebasestorage.app",
      messagingSenderId: "140276684303",
      appId: "1:140276684303:web:e6bb0bf5a3f9dd3b00357a",
      measurementId: "G-X1BDKR6XMP"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Voting system
    let votes = new Map(); // Cache votes locally
    let userVotes = new Map(); // Track user's votes in this session

    async function loadVotes() {
      const snapshot = await db.collection('votes').get();
      votes.clear();
      snapshot.forEach(doc => {
        const data = doc.data();
        votes.set(doc.id, { likes: data.likes || 0, dislikes: data.dislikes || 0 });
      });
      return votes;
    }

    async function vote(itemId, isLike) {
      const voteRef = db.collection('votes').doc(itemId.toString());
      const current = votes.get(itemId) || { likes: 0, dislikes: 0 };
      const previousVote = userVotes.get(itemId);
      
      // Remove previous vote if switching
      if (previousVote !== undefined) {
        if (previousVote === isLike) {
          // Clicking same button again = remove vote
          if (isLike) current.likes = Math.max(0, current.likes - 1);
          else current.dislikes = Math.max(0, current.dislikes - 1);
          userVotes.delete(itemId);
        } else {
          // Switching vote
          if (isLike) {
            current.dislikes = Math.max(0, current.dislikes - 1);
            current.likes++;
          } else {
            current.likes = Math.max(0, current.likes - 1);
            current.dislikes++;
          }
          userVotes.set(itemId, isLike);
        }
      } else {
        // New vote
        if (isLike) current.likes++;
        else current.dislikes++;
        userVotes.set(itemId, isLike);
      }

      // Update UI immediately
      updateVoteButtons(itemId);
      
      // Save to Firebase
      await voteRef.set(current);
      votes.set(itemId, current);
      
      // Re-sort if in popular mode
      if (state.sort === 'popular') applyFilters();
    }

    function getVoteScore(itemId) {
      const v = votes.get(itemId);
      return v ? v.likes - v.dislikes : 0;
    }

    function updateVoteButtons(itemId) {
      const v = votes.get(itemId) || { likes: 0, dislikes: 0 };
      const userVote = userVotes.get(itemId);
      
      const likeBtn = document.getElementById('likeBtn');
      const dislikeBtn = document.getElementById('dislikeBtn');
      const likeCount = document.getElementById('likeCount');
      const dislikeCount = document.getElementById('dislikeCount');
      
      likeCount.textContent = v.likes;
      dislikeCount.textContent = v.dislikes;
      
      likeBtn.classList.toggle('active', userVote === true);
      dislikeBtn.classList.toggle('active', userVote === false);
    }

    // Load initial votes
    loadVotes().then(() => {
      // Re-render if in popular sort mode
      if (state.sort === 'popular') applyFilters();
    });

    // Sample data array
    // To use an external image for a thumbnail, add a `thumbUrl: 'https://your.image/url.jpg'` property to an item.
    const items = [
      // Example with a custom image URL (replace with your own image link):
      {id:1,title:'Starlight Heist',type:'Movie',year:2024,genres:['Action','Sci-Fi'],desc:'A crew of misfits attempts the ultimate space heist.',link:'https://example.com/starlight-heist',thumbColor:'#d1495b', thumbUrl:'https://placehold.co/800x450/png/ffffff/000000?text=Starlight+Heist'},
      {id:2,title:'Midnight Diner',type:'TV',year:2021,genres:['Drama','Slice of Life'],desc:'Late-night stories woven around a cozy diner.',link:'https://example.com/midnight-diner',thumbColor:'#2b8a77'},
      {id:3,title:'Neon Racers',type:'Movie',year:2022,genres:['Action','Thriller'],desc:'Illegal street races collide with corporate intrigue.',link:'https://example.com/neon-racers',thumbColor:'#f3a712'},
      {id:4,title:'Planetarium',type:'TV',year:2020,genres:['Documentary'],desc:'A deep dive into the wonders of the night sky.',link:'https://example.com/planetarium',thumbColor:'#3b6ea5'},
      {id:5,title:'Hearts & Algorithms',type:'Movie',year:2023,genres:['Romance','Sci-Fi'],desc:'When two AIs fall in love, the world takes notice.',link:'https://example.com/hearts-algorithms',thumbColor:'#b24bfb'},
      {id:6,title:'County Lines',type:'TV',year:2019,genres:['Crime','Drama'],desc:'A gritty procedural following a small town police force.',link:'https://example.com/county-lines',thumbColor:'#6e6d9a'},
      {id:7,title:'Cook Off',type:'TV',year:2025,genres:['Reality','Comedy'],desc:'Chefs from around the world compete with quirky challenges.',link:'https://example.com/cook-off',thumbColor:'#f25f5c', thumbUrl: 'https://placehold.co/800x450/png/ffffff/000000?text=Cook+Off'},
      {id:8,title:'Lighthouse Keepers',type:'Movie',year:2018,genres:['Mystery','Horror'],desc:'An isolated lighthouse holds a centuries-old secret.',link:'https://example.com/lighthouse-keepers',thumbColor:'#0b6e4f', thumbUrl:'https://placehold.co/800x450/png/ffffff/000000?text=Lighthouse+Keepers'},
      {id:9,title:'Pixel Quest',type:'Movie',year:2025,genres:['Animation','Family'],desc:'A shy kid discovers a video game world that changes reality.',link:'https://example.com/pixel-quest',thumbColor:'#ff7eb6', thumbUrl:'https://placehold.co/800x450/png/ffffff/000000?text=Pixel+Quest'},
      {id:10,title:'The Long Walk Home',type:'TV',year:2022,genres:['Drama'],desc:'Interlinked stories of people walking home across a city.',link:'https://example.com/long-walk-home',thumbColor:'#2d3e50'},
      {id:11,title:'Quantum Court',type:'TV',year:2024,genres:['Sci-Fi','Legal'],desc:'Courtroom drama with quantum evidence and ethical dilemmas.',link:'https://example.com/quantum-court',thumbColor:'#16a085'},
      {id:12,title:'Retrograde',type:'Movie',year:2021,genres:['Thriller','Mystery'],desc:'Flashback-driven crime story with a twist.',link:'https://example.com/retrograde',thumbColor:'#ffb3c1'}
    ];

  // Elements
  const grid = document.getElementById('grid');
  const searchInput = document.getElementById('searchInput');
  const categoryChips = document.getElementById('categoryChips');
  const tabsContainer = document.getElementById('tabs');
  const sortSelect = document.getElementById('sortSelect');
  const clearBtn = document.getElementById('clearBtn');

    // Overlay
    const overlay = document.getElementById('overlay');
    const overlayTitle = document.getElementById('overlayTitle');
    const overlayDesc = document.getElementById('overlayDesc');
    const overlayThumb = document.getElementById('overlayThumb');
    const overlayMeta = document.getElementById('overlayMeta');
    const overlayTags = document.getElementById('overlayTags');
    const closeOverlay = document.getElementById('closeOverlay');
    const openNew = document.getElementById('openNew');
    const openParent = document.getElementById('openParent');

  // State (added `tab` to track All / Movie / TV)
  let state = {query:'',category:'All',sort:'popular',tab:'All'};

    // Utility: generate simple SVG thumbnail with title initials as data URL
    function svgThumb(text,bg){
      const initials = text.split(' ').slice(0,2).map(s=>s[0]).join('').toUpperCase();
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='450'><rect width='100%' height='100%' fill='${bg}'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='80' fill='rgba(255,255,255,0.95)'>${initials}</text></svg>`;
      return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }

    // Render tabs (All / Movies / TV Shows)
    function renderTabs(){
      if(!tabsContainer) return;
      const buttons = Array.from(tabsContainer.querySelectorAll('button'));
      buttons.forEach(btn=>{
        const tab = btn.getAttribute('data-tab');
        btn.classList.toggle('active', state.tab === tab);
        btn.onclick = ()=>{ state.tab = tab; /* keep category for compatibility */ state.category = 'All'; applyFilters(); renderTabs(); };
      });
    }

    // Render grid of cards
    function renderGrid(list){
      grid.innerHTML = '';
      if(list.length===0){ grid.innerHTML = '<div style="color:var(--muted);padding:30px;font-size:15px">No results found — try different search terms or filters.</div>'; return }
      list.forEach(item=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('role','listitem');
        card.onclick = ()=>openDetails(item);

  const thumb = document.createElement('div');
  thumb.className = 'thumb';
  // Prefer an explicit image URL (thumbUrl) if provided, otherwise generate an SVG thumb
  const thumbSrc = item.thumbUrl ? item.thumbUrl : svgThumb(item.title,item.thumbColor);
  thumb.style.backgroundImage = `url(${thumbSrc})`;
        thumb.style.backgroundSize = 'cover';
        thumb.style.backgroundPosition = 'center';
        card.appendChild(thumb);

        const meta = document.createElement('div');
        meta.className = 'meta';
        const t = document.createElement('div');
        t.className = 'titleSmall'; t.textContent = item.title;
        const s = document.createElement('div'); s.className='sub'; s.textContent = item.year;
        meta.appendChild(t); meta.appendChild(s);
        card.appendChild(meta);

        const tags = document.createElement('div'); tags.className='tags';
        const tagType = document.createElement('div'); tagType.className='tag'; tagType.textContent = item.type;
        tags.appendChild(tagType);
        item.genres.slice(0,2).forEach(g=>{ const tg=document.createElement('div'); tg.className='tag'; tg.textContent=g; tags.appendChild(tg)});
        card.appendChild(tags);

        grid.appendChild(card);
      });
    }

    // Open details overlay
    let currentItem = null;
    function openDetails(item){
      currentItem = item;
      overlayTitle.textContent = item.title;
      overlayDesc.textContent = item.desc;
      const overlayThumbSrc = item.thumbUrl ? item.thumbUrl : svgThumb(item.title,item.thumbColor);
      overlayThumb.style.backgroundImage = `url(${overlayThumbSrc})`;
      overlayMeta.textContent = item.type + ' • ' + item.year;
      overlayTags.innerHTML = '';
      item.genres.forEach(g=>{ const el=document.createElement('div'); el.className='tag'; el.textContent=g; overlayTags.appendChild(el) });
      
      // Set up voting buttons
      updateVoteButtons(item.id);
      const likeBtn = document.getElementById('likeBtn');
      const dislikeBtn = document.getElementById('dislikeBtn');
      likeBtn.onclick = () => vote(item.id, true);
      dislikeBtn.onclick = () => vote(item.id, false);
      openNew.onclick = ()=>window.open(item.link,'_blank');
      openParent.onclick = ()=>{
        try{
          // attempt to navigate parent (may be blocked depending on Google Sites embed sandbox)
          if(window.top && window.top !== window) window.top.location.href = item.link;
          else window.location.href = item.link;
        }catch(e){ window.open(item.link,'_blank'); }
      };
      overlay.classList.add('show');
      overlay.focus();
    }

    function closeDetails(){ overlay.classList.remove('show'); currentItem = null }

    closeOverlay.onclick = closeDetails;
    overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closeDetails() });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeDetails() });

    // Filtering & search
    function normalize(s){ return (s||'').toString().toLowerCase(); }
    function applyFilters(){
      const q = normalize(state.query);
      let res = items.filter(it=>{
        // Apply both tab-based filtering (preferred) and legacy category filtering if set
        if(state.tab && state.tab!=='All' && it.type !== state.tab) return false;
        if(state.category && state.category!=='All' && it.type!==state.category) return false;
        // search in title, genres, year, desc
        if(q==='') return true;
        const hay = normalize(it.title + ' ' + it.genres.join(' ') + ' ' + it.year + ' ' + it.desc);
        return hay.includes(q);
      });
      if(state.sort==='title') res.sort((a,b)=>a.title.localeCompare(b.title));
      else if(state.sort==='year') res.sort((a,b)=>b.year - a.year);
      else if(state.sort==='popular') res.sort((a,b)=>getVoteScore(b.id) - getVoteScore(a.id));
      renderGrid(res);
    }

    // Debounce helper
    function debounce(fn,delay=220){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),delay)} }

    // Events
    searchInput.addEventListener('input', debounce((e)=>{ state.query = e.target.value; applyFilters() }));
    sortSelect.addEventListener('change', (e)=>{ state.sort = e.target.value; applyFilters() });
  clearBtn.addEventListener('click', ()=>{ state={query:'',category:'All',sort:'popular',tab:'All'}; searchInput.value=''; sortSelect.value='popular'; renderTabs(); applyFilters(); });

  // Initial render
  function render(){ renderTabs(); applyFilters(); }
  render();

    // Small accessibility: resize observer to keep grid responsive (placeholder for progressive enhancements)
  </script>
</body>
</html>
